/**
 * Copyright (c) Bjarki Gudlaugsson (codehugger at codehuggers.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are
 * permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright notice, this list of
 *        conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above copyright notice, this
 *       list of conditions and the following disclaimer in the documentation and/or other
 *       materials  provided with the distribution.
 *
 *     * Neither the name of the <ORGANIZATION> nor the names of its contributors may be
 *       used to endorse or promote products derived from this software without specific
 *       prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL
 * THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT
 * OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
 * TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE,  EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

(function(a){Date.prototype.daysInMonth=function(){return new Date(this.getFullYear(),this.getMonth()+1,0).getDate()};Date.prototype.getWeek=function(){var b=new Date(this.getFullYear(),0,1);return Math.ceil((((this-b)/86400000)+b.getDay()+1)/7)};Date.prototype.startOfDay=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0,0)};Date.prototype.endOfDay=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate(),23,59,59,999)};Date.prototype.startOfWeek=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate()-this.getDay()).startOfDay()};Date.prototype.endOfWeek=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate()+(6-this.getDay())).endOfDay()};Date.prototype.startOfMonth=function(){return new Date(this.getFullYear(),this.getMonth(),1).startOfDay()};Date.prototype.endOfMonth=function(){return new Date(this.getFullYear(),this.getMonth(),this.daysInMonth()).endOfDay()};Date.prototype.startOfCalendar=function(){return(new Date(this.getFullYear(),this.getMonth(),1)).startOfWeek()};Date.prototype.endOfCalendar=function(){return(new Date(this.getFullYear(),this.getMonth(),this.daysInMonth())).endOfWeek()};a.fn.rangepicker=function(H){var p=this;var z=new Date().startOfDay().valueOf();var n=7;var I=6;var R=0;var N=1;var U=2;var F=3;var j=["day","week","month","custom"];var f,m;var d,B,y,r,J,E,c;var ac,u,s,x,ae,g,af,o,w,L,O,aa;var v,i,W,l,b;function ab(ag){selectedDate=new Date(a(this).attr("id"));if(cyclePeriodTypes){if(d.valueOf()===selectedDate.valueOf()&&r==R){r=N}else{if(d.valueOf()===selectedDate.valueOf()&&r==N){r=U}else{if(d.valueOf()===selectedDate.valueOf()&&r==U){r=R}}}}d=selectedDate;X();if((r===F&&followCustom)||(r!==F&&followFixed)){J=selectedDate.startOfMonth()}M();ag.preventDefault()}function ad(ag){d=new Date(B);r=R;J=B.startOfMonth();X();M();ag.preventDefault()}function Z(ag){r=F;M();ag.preventDefault()}function K(ah){var ag=J.getMonth()-1;if(ag<0){J.setFullYear(J.getFullYear()-1);ag=11}J.setMonth(ag);M();ah.preventDefault()}function Q(ah){var ag=J.getMonth()+1;if(ag>11){J.setFullYear(J.getFullYear()+1);ag=0}J.setMonth(ag);M();ah.preventDefault()}function A(ag){J=new Date(B.startOfMonth());M();ag.preventDefault()}function Y(ag){J=new Date(z).startOfMonth();M();ag.preventDefault()}function G(ag){J=new Date(y.startOfMonth());M();ag.preventDefault()}function S(ah){var ag=a(ae);ag.attr("id",ah.strftime(m));ag.html(ah.getDate());if(ah.valueOf()===z){ag.addClass(W)}if(ah.valueOf()>=B.valueOf()&&ah.valueOf()<=y.valueOf()){ag.addClass(i)}if(r===F){if(ah.valueOf()===B.startOfDay().valueOf()||ah.valueOf()===y.startOfDay().valueOf()){ag.addClass(v)}}else{if(ah.valueOf()===d.valueOf()){ag.addClass(v)}}if(ah.getMonth()!==J.getMonth()){ag.addClass(l)}if((minDate===null||ah>minDate)&&(maxDate===null||ah<maxDate)){ag.on("click",ab)}else{ag.on("click",function(ai){ai.preventDefault()});ag.addClass("disabled")}return ag}function D(ah){var ag=a(x);for(var ai=0;ai<n;ai++){ag.append(S(new Date(ah)));ah.setDate(ah.getDate()+1)}return ag}function h(ag){var ai=a(s);for(var ah=0;ah<I;ah++){ai.append(D(new Date(ag)));ag.setDate(ag.getDate()+n)}return ai}function V(){return a(u).append(h(new Date(J.startOfCalendar())))}function q(){var ai=a(rangeTemplate);var ag=a(fromTemplate);var aj=a(todayTemplate);var ah=a(toTemplate);ag.attr("id",B.strftime(m));ag.html(B.strftime(m));aj.attr("id",new Date(z).strftime(m));ah.attr("id",y.strftime(m));ah.html(y.strftime(m));ag.on("click",A);aj.on("click",Y);ah.on("click",G);ai.append(ag);ai.append(aj);ai.append(ah);return ai}function P(){var aj=a(g);var ai=a(af);var ag=a(o).html(J.strftime(f));var ah=a(w);if(minDate===null||minDate<J){ai.on("click",K)}else{ai.on("click",function(ak){ak.preventDefault()});ai.addClass("disabled")}if(maxDate===null||maxDate>J.endOfMonth()){ah.on("click",Q)}else{ah.on("click",function(ak){ak.preventDefault()});ah.addClass("disabled")}aj.append(ai);aj.append(ag);aj.append(ah);return aj}function k(){var ah=a(L);var ag=a(O);var ai=a(aa);ag.on("click",ad);ai.on("click",Z);ah.append(ag);ah.append(ai);if(r===F){ai.addClass(b)}else{ag.addClass(b)}return ah}function X(){if(r===F){if(E){y=d.endOfDay();if(B>y){var ag=B.startOfDay();B=y.startOfDay();y=ag}t()}else{B=d.startOfDay();y=d.endOfDay()}E=!E}else{from=new Date(d.valueOf());to=new Date(d.valueOf());if(r===R){from=from.startOfDay();to=to.endOfDay()}else{if(r===N){from=from.startOfWeek();to=to.endOfWeek()}else{if(r===U){from=from.startOfMonth();to=to.endOfMonth()}}}if(minDate&&from<minDate){from=new Date(minDate.valueOf())}if(maxDate&&to>maxDate){to=new Date(maxDate.valueOf())}B=from;y=to;t()}}function t(){if(c){c([B,y])}}function C(){if(onInit){onInit([B,y])}}function e(){var ah=B.startOfDay();var ag=y.startOfDay();if(ah.valueOf()==ag.valueOf()&&r!=F){r=R}else{if(ah.getDay()===0&&ag.getDay()===6&&ah.getWeek()===ag.getWeek()&&r!==F){r=N}else{if(ah.getMonth()===ag.getMonth()&&ah.getDate()===1&&(ag.getDate()===ah.daysInMonth()||ag.getDate()===maxDate.getDate())&&r!==F){r=U}else{E=false;r=F}}}}function M(){var ag=a(ac);ag.append(P());ag.append(q());ag.append(V());ag.append(k());p.html(ag)}function T(ag){if(ag===undefined){ag={}}d=ag.currentDate||new Date().startOfDay();B=ag.dateFrom||d.startOfDay();y=ag.dateTo||d.endOfDay();r=ag.periodType||"day";J=ag.displayedDate||d.startOfMonth();onInit=ag.onInit||undefined;c=ag.onUpdate||undefined;cyclePeriodTypes=ag.cycleModes||true;E=false;m=ag.dateFormat||"%Y-%m-%d";f=ag.labelFormat||"%B %Y";minDate=ag.minDate||null;maxDate=ag.maxDate||new Date();followFixed=ag.followFixed||true;followCustom=ag.followCustom||false;ac=ag.rootTemplate||'<div class="rangepicker"></div>';ae=ag.dayTemplate||'<a href="#" class="day"></a>';x=ag.weekTemplate||'<div class="week"></div>';s=ag.monthTemplate||'<div class="month"></div>';u=ag.calendarTemplate||'<div class="calendar"></div>';g=ag.navTemplate||'<div class="navigation"></div>';af=ag.prevTemplate||'<a href="#" class="prev">&lt;</a>';o=ag.displayTemplate||'<span class="display"></span>';w=ag.nextTemplate||'<a href="#" class="next">&gt;</a>';rangeTemplate=ag.rangeTemplate||'<div class="range"></div>';fromTemplate=ag.fromTemplate||'<a href="#" class="from"></a>';todayTemplate=ag.todayTemplate||'<a href="#" class="today">Today</a>';toTemplate=ag.toTemplate||'<a href="#" class="to"></a>';L=ag.modeTemplate||'<div class="mode"></div>';O=ag.fixedTemplate||'<a href="#" class="fixed">Fixed</a>';aa=ag.customTemplate||'<a href="#" class="custom">Custom</a>';l=ag.disabledClass||"disabled";v=ag.selectedClass||"selected";i=ag.includedClass||"included";b=ag.activeClass||"active";W=ag.todayClass||"today";a.each(function(ah,ai){if(ai===r){r=ah}});if(B&&y){r=R;e();d=B.startOfDay()}J=B.startOfMonth();C();M();return p}return T(H)}}(jQuery));