/**
 * Copyright (c) Bjarki Gudlaugsson (codehugger at codehuggers.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are
 * permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright notice, this list of
 *        conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above copyright notice, this
 *       list of conditions and the following disclaimer in the documentation and/or other
 *       materials  provided with the distribution.
 *
 *     * Neither the name of the <ORGANIZATION> nor the names of its contributors may be
 *       used to endorse or promote products derived from this software without specific
 *       prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL
 * THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT
 * OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
 * TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE,  EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

(function(a){Date.prototype.daysInMonth=function(){return new Date(this.getFullYear(),this.getMonth()+1,0).getDate()};Date.prototype.getWeek=function(){var b=new Date(this.getFullYear(),0,1);return Math.ceil((((this-b)/86400000)+b.getDay()+1)/7)};Date.prototype.startOfDay=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0,0)};Date.prototype.endOfDay=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate(),23,59,59,999)};Date.prototype.startOfWeek=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate()-this.getDay()).startOfDay()};Date.prototype.endOfWeek=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate()+(6-this.getDay())).endOfDay()};Date.prototype.startOfMonth=function(){return new Date(this.getFullYear(),this.getMonth(),1).startOfDay()};Date.prototype.endOfMonth=function(){return new Date(this.getFullYear(),this.getMonth(),this.daysInMonth()).endOfDay()};Date.prototype.startOfCalendar=function(){return(new Date(this.getFullYear(),this.getMonth(),1)).startOfWeek()};Date.prototype.endOfCalendar=function(){return(new Date(this.getFullYear(),this.getMonth(),this.daysInMonth())).endOfWeek()};a.fn.rangepicker=function(F){var p=this;var y=new Date().startOfDay().valueOf();var n=7;var G=6;var P=0;var L=1;var S=2;var D=3;var j=["day","week","month","custom"];var f,m;var d,A,x,r,H,C,c;var aa,t,s,w,ac,g,ad,o,v,J,M,Y;var u,i,U,l,b;function Z(ae){selectedDate=new Date(a(this).attr("id"));if(cyclePeriodTypes){if(d.valueOf()===selectedDate.valueOf()&&r==P){r=L}else{if(d.valueOf()===selectedDate.valueOf()&&r==L){r=S}else{if(d.valueOf()===selectedDate.valueOf()&&r==S){r=P}}}}d=selectedDate;V();if((r===D&&followCustom)||(r!==D&&followFixed)){H=selectedDate.startOfMonth()}K();ae.preventDefault()}function ab(ae){d=new Date(A);r=P;e();H=A.startOfMonth();V();K();ae.preventDefault()}function X(ae){r=D;K();ae.preventDefault()}function I(af){var ae=H.getMonth()-1;if(ae<0){H.setFullYear(H.getFullYear()-1);ae=11}H.setMonth(ae);K();af.preventDefault()}function O(af){var ae=H.getMonth()+1;if(ae>11){H.setFullYear(H.getFullYear()+1);ae=0}H.setMonth(ae);K();af.preventDefault()}function z(ae){H=new Date(A.startOfMonth());K();ae.preventDefault()}function W(ae){H=new Date(y).startOfMonth();K();ae.preventDefault()}function E(ae){H=new Date(x.startOfMonth());K();ae.preventDefault()}function Q(af){var ae=a(ac);ae.attr("id",af.strftime(m));ae.html(af.getDate());if(af.valueOf()===y){ae.addClass(U)}if(af.valueOf()>=A.valueOf()&&af.valueOf()<=x.valueOf()){ae.addClass(i)}if(r===D){if(af.valueOf()===A.startOfDay().valueOf()||af.valueOf()===x.startOfDay().valueOf()){ae.addClass(u)}}else{if(af.valueOf()===d.valueOf()){ae.addClass(u)}}if(af.getMonth()!==H.getMonth()){ae.addClass(l)}if((minDate===null||af>minDate)&&(maxDate===null||af<maxDate)){ae.on("click",Z)}else{ae.on("click",function(ag){ag.preventDefault()});ae.addClass("disabled")}return ae}function B(af){var ae=a(w);for(var ag=0;ag<n;ag++){ae.append(Q(new Date(af)));af.setDate(af.getDate()+1)}return ae}function h(ae){var ag=a(s);for(var af=0;af<G;af++){ag.append(B(new Date(ae)));ae.setDate(ae.getDate()+n)}return ag}function T(){return a(t).append(h(new Date(H.startOfCalendar())))}function q(){var ag=a(rangeTemplate);var ae=a(fromTemplate);var ah=a(todayTemplate);var af=a(toTemplate);ae.attr("id",A.strftime(m));ae.html(A.strftime(m));ah.attr("id",new Date(y).strftime(m));af.attr("id",x.strftime(m));af.html(x.strftime(m));ae.on("click",z);ah.on("click",W);af.on("click",E);ag.append(ae);ag.append(ah);ag.append(af);return ag}function N(){var ah=a(g);var ag=a(ad);var ae=a(o).html(H.strftime(f));var af=a(v);if(minDate===null||minDate<H){ag.on("click",I)}else{ag.on("click",function(ai){ai.preventDefault()});ag.addClass("disabled")}if(maxDate===null||maxDate>H.endOfMonth()){af.on("click",O)}else{af.on("click",function(ai){ai.preventDefault()});af.addClass("disabled")}ah.append(ag);ah.append(ae);ah.append(af);return ah}function k(){var af=a(J);var ae=a(M);var ag=a(Y);ae.on("click",ab);ag.on("click",X);af.append(ae);af.append(ag);if(r===D){ag.addClass(b)}else{ae.addClass(b)}return af}function V(){if(r===D){if(C){x=d.endOfDay();if(A>x){var ae=A.startOfDay();A=x.startOfDay();x=ae}if(c){c([A,x])}}else{A=d.startOfDay();x=d.endOfDay()}C=!C}else{from=new Date(d.valueOf());to=new Date(d.valueOf());if(r===P){from=from.startOfDay();to=to.endOfDay()}else{if(r===L){from=from.startOfWeek();to=to.endOfWeek()}else{if(r===S){from=from.startOfMonth();to=to.endOfMonth()}}}if(minDate&&from<minDate){from=new Date(minDate.valueOf())}if(maxDate&&to>maxDate){to=new Date(maxDate.valueOf())}A=from;x=to;if(c){c([A,x])}}}function e(){from=A.startOfDay();to=x.startOfDay();if(from===to&&r!==D){r=P}else{if(from.getDay()===0&&to.getDay()===6&&from.getWeek()===to.getWeek()&&r!==D){r=L}else{if(from.getMonth()===to.getMonth()&&from.getDate()===1&&(to.getDate()===from.daysInMonth()||to.getDate()===maxDate.getDate())&&r!==D){r=S}else{C=false}}}}function K(){var ae=a(aa);ae.append(N());ae.append(q());ae.append(T());ae.append(k());p.html(ae)}function R(ae){if(ae===undefined){ae={}}d=ae.currentDate||new Date().startOfDay();A=ae.dateFrom||d.startOfDay();x=ae.dateTo||d.endOfDay();r=ae.periodType||"day";H=ae.displayedDate||d.startOfMonth();c=ae.onUpdate||undefined;cyclePeriodTypes=ae.cycleModes||true;C=false;m=ae.dateFormat||"%Y-%m-%d";f=ae.labelFormat||"%B %Y";minDate=ae.minDate||null;maxDate=ae.maxDate||new Date();followFixed=ae.followFixed||false;followCustom=ae.followCustom||false;aa=ae.rootTemplate||'<div class="rangepicker"></div>';ac=ae.dayTemplate||'<a href="#" class="day"></a>';w=ae.weekTemplate||'<div class="week"></div>';s=ae.monthTemplate||'<div class="month"></div>';t=ae.calendarTemplate||'<div class="calendar"></div>';g=ae.navTemplate||'<div class="navigation"></div>';ad=ae.prevTemplate||'<a href="#" class="prev">&lt;</a>';o=ae.displayTemplate||'<span class="display"></span>';v=ae.nextTemplate||'<a href="#" class="next">&gt;</a>';rangeTemplate=ae.rangeTemplate||'<div class="range"></div>';fromTemplate=ae.fromTemplate||'<a href="#" class="from"></a>';todayTemplate=ae.todayTemplate||'<a href="#" class="today">Today</a>';toTemplate=ae.toTemplate||'<a href="#" class="to"></a>';J=ae.modeTemplate||'<div class="mode"></div>';M=ae.fixedTemplate||'<a href="#" class="fixed">Fixed</a>';Y=ae.customTemplate||'<a href="#" class="custom">Custom</a>';l=ae.disabledClass||"disabled";u=ae.selectedClass||"selected";i=ae.includedClass||"included";b=ae.activeClass||"active";U=ae.todayClass||"today";a.each(function(af,ag){if(ag===r){r=af}});if(A&&x){r=D;e();d=A.startOfDay()}H=A.startOfMonth();if(c){c([A,x])}K();return p}return R(F)}}(jQuery));